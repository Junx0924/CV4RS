login to HPC
ssh jun0924@sshgate.tu-berlin.de

Requirements on Ubuntu 20 :
   //command to install modules
    conda install -c pytorch torchvision
    conda install -c pytorch faiss-gpu
    conda install pytorch
    conda install -c conda-forge wandb
    
    pip install opencv-python
    pip install  pretrainedmodels
    
    //install GDAL
    sudo apt install gdal-bin
    sudo apt-get install libgdal-dev
    export CPLUS_INCLUDE_PATH=/usr/include/gdal
    export C_INCLUDE_PATH=/usr/include/gdal
    ogrinfo --version
    pip install GDAL==3.0.4
    
    //install GPU driver
    sudo lshw -C display
    Remove older Nvidia driver:

sudo apt-get purge nvidia*

Add the graphics-driver PPA

sudo add-apt-repository ppa:graphics-drivers/ppa

Then update:

sudo apt-get update 
And install (and activate) the latest Nvidia graphics drivers First check the version you want on the graphics drivers PPA homepage

sudo apt install nvidia-driver-410

Or whatever version you want:

sudo apt install nvidia-driver-430

//set vscode
"python.linting.pylintArgs": ["--generate-members", "--extension-pkg-whitelist=cv2"]

PCA reduce the dimensions, then feed to Deep Metric Network
#######################
HPC:
ssh jun0924@sshgate.tu-berlin.de
ssh gateway.hpc.tu-berlin.de 
module load python/3.7.1
python -m venv /home/users/j/jun0924/venv
source venv/bin/activate
cd venv
# check python version
python -m pip --version
pip install --upgrade pip  
pip install torch==1.4.0 torchvision==0.5.0 -f  
pip install  pretrainedmodels  
pip install  faiss-gpu  
pip install  wandb  


# install GDAL, need to install proj first (choose the version compiltable for 
# sqlite 3.7)
wget https://download.osgeo.org/proj/proj-6.1.1.tar.gz
tar -zxvf proj-6.1.1.tar.gz
cd proj-6.1.1
./configure --prefix=/home/users/j/jun0924/
make
make install

#install GDAL
wget https://github.com/OSGeo/gdal/releases/download/v3.2.0/gdal-3.2.0.tar.gz
tar -zxvf gdal-3.2.0.tar.gz
cd gdal-3.2.0
./configure --prefix=/home/users/j/jun0924/ --with-proj=/home/users/j/jun0924/ --with-python
make
make install
export LD_LIBRARY_PATH=/home/users/j/jun0924/lib
pip install GDAL==3.2.0  

# check which python version
which python
python -V
python
# check if all the modules can be loaded
import numpy
import torch
# Problem encountered
OpenBLAS blas_thread_init: pthread_create failed for thread 27 of 36: Resource temporarily unavailable
OpenBLAS blas_thread_init: RLIMIT_NPROC 514120 current, 514120 max

# solution
export OMP_NUM_THREADS=1
export USE_SIMPLE_THREADED_LEVEL3=1

# load cuda
module load nvidia/cuda/9.0

# download dataset
mkdir Dataset
cd Dataset
wget http://bigearth.net/downloads/BigEarthNet-v1.0.tar.gz
# copy file from local to HPC server
scp -o 'ProxyJump jun0924@sshgate.tu-berlin.de' ./* jun0924@gateway.hpc.tu-berlin.de:/scratch/CV4RS/Dataset/MLRSNet/split
tar -zxvf BigEarthNet-v1.0.tar.gz
#
cd CV4RS/1_DiVA_MultiFeature_DML
mkdir /home/users/j/jun0924/Diva
# CV4RS/1_DiVA_MultiFeature_DML/diva_main.py
sbatch run_diva.sh
squeue | grep "jun0924"
scancel jobid

# get the list of python module installed
pip freeze > requirements.txt
